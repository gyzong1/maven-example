name: Fetch OIDC Token

on: [push]

jobs:
  fetch-token:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Request OIDC Token
        id: request_token
        run: |
          echo "Requesting OIDC Token"
          TOKEN=$(curl -H "User-Agent: actions/oidc-client" \
                        -H "Authorization: Bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN" \
                        "${ACTIONS_ID_TOKEN_REQUEST_URL}" | jq -r '.value')
          echo "::add-mask::$TOKEN"  # Mask the token in logs
          echo "ID_TOKEN=$TOKEN" >> $GITHUB_ENV  # Add the token to environment variables

      - name: Print OIDC Token
        run: |
          echo "OIDC Token: $ID_TOKEN"
